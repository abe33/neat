<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>neat - Compilation and Packaging</title>
    <link rel='stylesheet' media='screen' href='pages.css'>
    <link href='http://netdna.bootstrapcdn.com/font-awesome/3.0/css/font-awesome.css' type='text/css' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Lato:300' rel='stylesheet' type='text/css'>
    <script src='http://code.jquery.com/jquery-1.6.2.min.js' type='text/javascript' charset='utf-8'></script>
    <script>
      $(document).ready(function(){
        var pres = $('pre code')
        pres.each(function(i,el){
          el = $(el)
          var text = el.html()
          var lines = text.split('\n')
          el.parent().append('<ol>' + lines.map(function(l){
            return '<li></li>'
          }).join('\n') + '</ol>')
        })
      })
    </script>
  </head>
  <body>
    <div id='main'>
      <header>
  <h1>neat</h1>
  <p>1.2.0</p>
</header>
      <nav>
  <ul>
    <li>
      <a class='icon-home' href='index.html'>Home</a>
    </li>
    <li>
      <a class='icon-file-alt' href='pages_index.html'>Pages</a>
    </li>
    <li>
      <a class='icon-sitemap' href='docs&#47;src_index.html'>Documentation</a>
    </li>
    <li>
      <a class='icon-github' href='http:&#47;&#47;github.com&#47;abe33&#47;neat'>GitHub</a>
    </li>
  </ul>
</nav>
      <section><h1 id='compilation-and-packaging'>Compilation and Packaging</h1>
<p><code>Neat</code> is clearly opiniated and favor <code>CoffeeScript</code> over pure <code>JavaScript</code>.
As result, Neat provides tools to deal with compilation and packaging of
<code>coffee</code> files for both node and browsers.</p>
<p>These tools will allow you to perform operation on files at any point
of the process. And you can even easily build your own operators.</p>
<p>Most of the hard work is handled by the <code>cake build</code> task,
also aliased as <code>cake compile</code>. Builds are defined in the project <code>Neatfile</code>.</p>
<p><h3>Table Of Content</h3>
<ul class='toc'>
  <li class='level0'>
    <a href='#compilation-and-packaging'>Compilation and Packaging</a>
  </li>
  <li class='level1'>
    <a href='#neatfile'>Neatfile</a>
  </li>
  <li class='level2'>
    <a href='#build-operators'>Build Operators</a>
  </li>
  <li class='level3'>
    <a href='#common'>Common</a>
  </li>
  <li class='level3'>
    <a href='#coffeescript'>CoffeeSCript</a>
  </li>
  <li class='level3'>
    <a href='#javascript'>JavaScript</a>
  </li>
  <li class='level2'>
    <a href='#build-utilities'>Build Utilities</a>
  </li>
  <li class='level2'>
    <a href='#custom-build-operators'>Custom Build Operators</a>
  </li>
  <li class='level3'>
    <a href='#without-configuration'>Without Configuration</a>
  </li>
  <li class='level3'>
    <a href='#with-configuration'>With Configuration</a>
  </li>
</ul></p>
<h2 id='neatfile'>Neatfile</h2>
<p>Every Neat project have a <code>Neatfile</code> at its root. The <code>Neatfile</code> describes
the build process to operate for a project.</p>
<p>The default <code>Neatfile</code> look like this:</p>
<pre><code>build <span class="string"><span class="string_begin">'</span>lib<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="group"><span class="group_begin">(</span>build<span class="group_end">)</span></span> <span class="function">-></span>
  <span class="comment"># Use glob like expression to source the build</span>
  build<span class="punctuation">.</span>source <span class="string"><span class="string_begin">'</span>src/**/*.coffee<span class="string_end">'</span></span>

  <span class="comment"># Invoke the processors you need</span>
  build
  <span class="punctuation">.</span><span class="keyword">do</span><span class="group"><span class="group_begin">(</span>compile <span class="property">bare<span class='punctuation'>:</span></span> <span class="literal">false</span><span class="group_end">)</span></span>      <span class="comment"># compile all the files</span>
  <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>remove <span class="string"><span class="string_begin">'</span>lib<span class="string_end">'</span></span><span class="group_end">)</span></span>           <span class="comment"># removes the lib directory</span>
  <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>relocate <span class="string"><span class="string_begin">'</span>src<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="string"><span class="string_begin">'</span>lib<span class="string_end">'</span></span><span class="group_end">)</span></span>  <span class="comment"># relocate the compiled file to lib</span>
  <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>writeFiles<span class="group_end">)</span></span>             <span class="comment"># write files to their path</span></code></pre>
<p>The <code>build</code> call initiate a new build with the name <code>lib</code>. The build is then
passed as argument to the block.</p>
<p>The <code>build.source</code> method allow to defines the patterns for files to process
in this build. As for the example, all the files with a coffee extension
will be processed by the build.</p>
<p>The <code>build.do</code> and <code>build.then</code> add operations in the build stack.
Each of these operation will be executed sequentially, passing from one
to another their results.</p>
<h3 id='build-operators'>Build Operators</h3>
<p>Operators are promise that operates on a file buffer. A file buffer
is a simple object where keys contains the file&#39;s path and values are
the content of these files. Such as</p>
<pre><code>buffer <span class="operators">=</span> <span class="hash"><span class="hash_begin">{</span>
  <span class="string"><span class="string_begin">'</span>/path/to/file_1<span class="string_end">'</span></span><span class="punctuation">:</span> <span class="string"><span class="string_begin">'</span>Content file 1<span class="string_end">'</span></span>
  <span class="string"><span class="string_begin">'</span>/path/to/file_2<span class="string_end">'</span></span><span class="punctuation">:</span> <span class="string"><span class="string_begin">'</span>Content file 2<span class="string_end">'</span></span>
<span class="hash_end">}</span></span></code></pre>
<p>The following operators are currently available:</p>
<p><strong>Note:</strong> Some processors requires a configuration, they&#39;ll be listed with
their arguments in the list below such as <code>compile(options)</code>. Processors
that don&#39;t needs arguments must be passed direcly without calling them.</p>
<h4 id='common'>Common</h4>
<ul>
<li><p><code>fileFooter(footer)</code>: Appends the given <code>footer</code> to each files in the
buffer.</p>
</li>
<li><p><code>fileHeader(header)</code>: Prepends the given <code>header</code> to each files in the
buffer.</p>
<p>Given a file <code>templates/LICENSE</code> containing:</p>
<pre><code class="lang-javascript"><span class="comment">/*
 * This is the license file.
 */</span></code></pre>
<p>You can prepend it to all files in the build with:</p>
<pre><code>build<span class="punctuation">.</span><span class="keyword">do</span><span class="group"><span class="group_begin">(</span>fileHeader load <span class="string"><span class="string_begin">'</span>templates/LICENSE<span class="string_end">'</span></span><span class="group_end">)</span></span></code></pre>
</li>
<li><code>join(filename)</code>: Joins all the files in the buffer into a single file
whose path is <code>filename</code>.</li>
<li><p><code>processExtension(ext, process)</code>: Performs operations on files that matches
the passed-in extension. The <code>process</code> argument is a promise returning
function that takes a promise whose value is a filtered buffer.
The function must return a promise whose value is a buffer as well.</p>
<pre><code>build <span class="string"><span class="string_begin">'</span>documentation<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="group"><span class="group_begin">(</span>build<span class="group_end">)</span></span> <span class="function">-></span>
  build<span class="punctuation">.</span>source <span class="string"><span class="string_begin">'</span>src/**/*.coffee<span class="string_end">'</span></span>
  build<span class="punctuation">.</span>source <span class="string"><span class="string_begin">'</span>src/**/*.js<span class="string_end">'</span></span>
  build<span class="punctuation">.</span>source <span class="string"><span class="string_begin">'</span>templates/**/*.html<span class="string_end">'</span></span>

  build
  <span class="punctuation">.</span><span class="keyword">do</span><span class="group"><span class="group_begin">(</span>remove <span class="string"><span class="string_begin">'</span>docs<span class="string_end">'</span></span><span class="group_end">)</span></span>
  <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>processExtension <span class="string"><span class="string_begin">'</span>coffee<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="group"><span class="group_begin">(</span>unit<span class="group_end">)</span></span> <span class="function">-></span>
    unit<span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>compile <span class="property">bare<span class='punctuation'>:</span></span> <span class="literal">true</span><span class="group_end">)</span></span>

  <span class="group_end">)</span></span><span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>processExtension <span class="string"><span class="string_begin">'</span>js<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="group"><span class="group_begin">(</span>unit<span class="group_end">)</span></span> <span class="function">-></span>
    unit
    <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>uglify<span class="group_end">)</span></span>
    <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>fileHeader load <span class="string"><span class="string_begin">'</span>templates/LICENSE<span class="string_end">'</span></span><span class="group_end">)</span></span>
    <span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>relocate <span class="string"><span class="string_begin">'</span>src<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="string"><span class="string_begin">'</span>docs/js<span class="string_end">'</span></span><span class="group_end">)</span></span>

  <span class="group_end">)</span></span><span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>processExtension <span class="string"><span class="string_begin">'</span>html<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="group"><span class="group_begin">(</span>unit<span class="group_end">)</span></span> <span class="function">-></span>
    unit<span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>relocate <span class="string"><span class="string_begin">'</span>templates<span class="string_end">'</span></span><span class="punctuation">,</span> <span class="string"><span class="string_begin">'</span>docs<span class="string_end">'</span></span><span class="group_end">)</span></span>

  <span class="group_end">)</span></span><span class="punctuation">.</span><span class="keyword">then</span><span class="group"><span class="group_begin">(</span>writeFiles<span class="group_end">)</span></span></code></pre>
</li>
<li><code>readFiles(paths)</code>: Loads the specified files and return a files buffer.
This processor is automatically added at the build start provides the
buffer containing all the files matching the patterns defined with the
<code>build.source</code> method.</li>
<li><code>relocate(from, to)</code>: Replace the <code>from</code> pattern with the <code>to</code> pattern
in the files paths.</li>
<li><code>remove(path)</code>: Removes the given path.</li>
<li><p><code>writeFiles</code>: Writes all the files in the buffer at their respective
path. Missing directories are created.</p>
<p>The processor can be placed severla time in the processing stack.
For instance you can write the files berfore and minification it will
give you files with <code>min.js</code> extension for the minified versions.</p>
</li>
</ul>
<h4 id='coffeescript'>CoffeeSCript</h4>
<ul>
<li><code>annotate</code>: Add JavaScript annotation comments in the coffee script files.
The results looks as:<pre><code><span class="embedded"><span class="embedded_begin">`</span>/* foo.coffee */<span class="embedded_end">`</span></span>
<span class="constant">Generator</span> <span class="operators">=</span> <span class="function">-></span>
  <span class="embedded"><span class="embedded_begin">`</span>/* foo.coffee<Foo> line:2 */<span class="embedded_end">`</span></span>
  <span class="class"><span class="keyword">class</span> <span class='title'>Foo</span></span>
    <span class="embedded"><span class="embedded_begin">`</span>/* foo.coffee<Foo.static> line:3 */<span class="embedded_end">`</span></span>
    <span class="property">@static<span class='punctuation'>:</span></span> <span class="function">-></span>
    <span class="embedded"><span class="embedded_begin">`</span>/* foo.coffee<Foo::constructor> line:4 */<span class="embedded_end">`</span></span>
    <span class="property">constructor<span class='punctuation'>:</span></span> <span class="function">-></span>
    <span class="embedded"><span class="embedded_begin">`</span>/* foo.coffee<Foo::method> line:5 */<span class="embedded_end">`</span></span>
    <span class="property">method<span class='punctuation'>:</span></span> <span class="function">-></span></code></pre>
</li>
<li><code>compile(options)</code>: Compiles the files in the buffer through the
the CoffeeScript compiler and change the path extension from <code>coffee</code>
to <code>js</code>.</li>
<li><p><code>exportsToPackage(package)</code>: Replace the module exports of nodejs code
with a packaged version.</p>
<p>For instance:</p>
<pre><code>build<span class="punctuation">.</span><span class="keyword">do</span><span class="group"><span class="group_begin">(</span>exportsToPackage <span class="string"><span class="string_begin">'</span>path.to.package<span class="string_end">'</span></span><span class="group_end">)</span></span></code></pre>
<p>Will prepend the following snippet in all files:</p>
<pre><code><span class="property">@path</span> <span class="operators">|</span><span class="operators">|</span><span class="operators">=</span> <span class="hash"><span class="hash_begin">{</span><span class="hash_end">}</span></span>
<span class="property">@path</span><span class="punctuation">.</span>to <span class="operators">|</span><span class="operators">|</span><span class="operators">=</span> <span class="hash"><span class="hash_begin">{</span><span class="hash_end">}</span></span>
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package <span class="operators">|</span><span class="operators">|</span><span class="operators">=</span> <span class="hash"><span class="hash_begin">{</span><span class="hash_end">}</span></span></code></pre>
<p>Below is various use cases and their results:</p>
<pre><code><span class="comment"># before</span>
<span class="global">exports</span><span class="punctuation">.</span>a <span class="operators">=</span> <span class="function">-></span> <span class="comment">#...</span>
<span class="comment"># after</span>
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">.</span>a <span class="operators">=</span> <span class="function">-></span> <span class="comment">#...</span></code></pre>
<pre><code><span class="comment"># before</span>
<span class="global">exports</span><span class="punctuation">[</span><span class="string"><span class="string_begin">'</span>a<span class="string_end">'</span></span><span class="punctuation">]</span> <span class="operators">=</span> <span class="function">-></span> <span class="comment">#...</span>
<span class="comment"># after</span>
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">[</span><span class="string"><span class="string_begin">'</span>a<span class="string_end">'</span></span><span class="punctuation">]</span> <span class="operators">=</span> <span class="function">-></span> <span class="comment">#...</span></code></pre>
<pre><code><span class="comment"># before</span>
<span class="global">module</span><span class="punctuation">.</span><span class="global">exports</span> <span class="operators">=</span> <span class="hash"><span class="hash_begin">{</span>a<span class="punctuation">,</span>b<span class="punctuation">,</span><span class="property">c<span class='punctuation'>:</span></span> <span class="number">10</span><span class="hash_end">}</span></span>
<span class="comment"># after</span>
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">.</span>a <span class="operators">=</span> a
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">.</span>b <span class="operators">=</span> b
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">.</span>c <span class="operators">=</span> <span class="number">10</span></code></pre>
<pre><code><span class="comment"># before</span>
<span class="global">module</span><span class="punctuation">.</span><span class="global">exports</span> <span class="operators">=</span> <span class="constant">MyClass</span>
<span class="comment"># after</span>
<span class="property">@path</span><span class="punctuation">.</span>to<span class="punctuation">.</span>package<span class="punctuation">.</span><span class="constant">MyClass</span> <span class="operators">=</span> <span class="constant">MyClass</span>
<span class="comment"># When a variable name is affected as exports, the variable</span>
<span class="comment"># name is used as property name on the package. It's useful</span>
<span class="comment"># to have a class available as module in node and accessible</span>
<span class="comment"># through its name when stored in a package.</span></code></pre>
</li>
<li><p><code>stripRequires</code>: Removes all lines that contains a call to <code>require</code>.</p>
</li>
</ul>
<h4 id='javascript'>JavaScript</h4>
<ul>
<li><code>uglify</code>: Minify the javascripts file through <code>uglify-js</code> and changes
the file extension from <code>js</code> to <code>min.js</code>.</li>
</ul>
<h3 id='build-utilities'>Build Utilities</h3>
<ul>
<li><code>load</code>: Loads the given file from the project root and returns its
content as a string.</li>
</ul>
<h3 id='custom-build-operators'>Custom Build Operators</h3>
<p>Custom build operators should be placed in the <code>lib/processing</code> directory.</p>
<h4 id='without-configuration'>Without Configuration</h4>
<pre><code>myCustomOperator <span class="operators">=</span> <span class="group"><span class="group_begin">(</span>buffer<span class="group_end">)</span></span> <span class="function">-></span>
  <span class="comment"># Either return a new buffer synchronously</span>
  <span class="comment"># or a promise whose value is a buffer</span></code></pre>
<h4 id='with-configuration'>With Configuration</h4>
<pre><code>myCustomOperator <span class="operators">=</span> <span class="group"><span class="group_begin">(</span>args<span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="group_end">)</span></span> <span class="function">-></span>
  <span class="comment"># The operator function returns a promise returning function</span>
  <span class="comment"># taking the buffer as argument.</span>

  <span class="keyword">return</span> <span class="group"><span class="group_begin">(</span>buffer<span class="group_end">)</span></span> <span class="function">-></span>
    <span class="comment"># Either return a new buffer synchronously</span>
    <span class="comment"># or a promise whose value is a buffer</span></code></pre>
</section>
      <footer>
  <nav>
    <h4>Links</h4>
    <ul>
      <li>
        <a href='http:&#47;&#47;github.com&#47;abe33&#47;neat&#47;issues&#47;'>Issues</a>
      </li>
      <li>
        <a href='docs&#47;src_index.html'>Documentation</a>
      </li>
      <li>
        <a href='http:&#47;&#47;github.com&#47;abe33&#47;neat'>GitHub</a>
      </li>
    </ul>
  </nav>
  <div class='vcard' id='contact'>
    <h4>Contact</h4>
    <ul>
      <li class='icon-envelope-alt'>
        <a class='email fn' href='mailto:cedric.nehemie@gmail.com'>Cédric Néhémie</a>
      </li>
      <li class='icon-home'>
        <a class='fn url website' href='http://cedric.nehemie.com'>http://cedric.nehemie.com</a>
      </li>
      <li class='icon-twitter'>
        <a class='twitter' href='http://twitter.com/cedricnehemie'>@cedricnehemie</a>
      </li>
    </ul>
  </div>
  <p class='copyright'>&copy; Copyright 2012 Cédric Néhémie</p>
</footer>
    </div>
  </body>
</html>